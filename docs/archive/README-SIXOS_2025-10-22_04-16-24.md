# SixOS Virtualization Environment ðŸŽŠ

A comprehensive QEMU/KVM setup specifically designed for SixOS (NixOS without systemd) development and testing on Framework 16 hardware.

## What is SixOS? ðŸ–¤ðŸ¤ŽðŸ’™

**SixOS** is a NixOS variant without systemd, announced at 38C3 in January 2025. It uses s6 supervision instead of systemd, providing:

- **Declarative configuration** - Your entire system in one config file
- **Atomic activation** - Changes are applied atomically with rollback
- **s6 supervision** - Lightweight process supervision (200KB vs 1.5MB)
- **Owner-boot security** - No unencrypted storage except EEPROM
- **Grainstore integration** - Verified dependencies and specifications

## Project Structure

```
~/kae3g/12025-10/
â”œâ”€â”€ vms/                    # Virtual machine storage
â”‚   â”œâ”€â”€ sixos-dev/         # SixOS development VM
â”‚   â”œâ”€â”€ sixos-test/        # SixOS testing VM
â”‚   â””â”€â”€ grainstore/        # Grainstore development files
â”œâ”€â”€ isos/                   # SixOS installer ISOs
â”œâ”€â”€ scripts/                # Management scripts
â”‚   â”œâ”€â”€ vm-manager.sh      # General VM management
â”‚   â”œâ”€â”€ sixos-vm-manager.bb # SixOS-specific management
â”‚   â””â”€â”€ sixos-build-iso.bb # SixOS ISO builder
â”œâ”€â”€ configs/                # Configuration files
â”‚   â””â”€â”€ sixos-vm-config.edn # SixOS VM specifications
â”œâ”€â”€ backups/                # VM backups
â””â”€â”€ logs/                   # Management logs
```

## Quick Start

### 1. Prerequisites Check
```bash
# Check if KVM is working
kvm-ok

# Check libvirt status
sudo systemctl status libvirtd
```

### 2. Build SixOS ISO
```bash
# Build SixOS installer ISO
bb scripts/sixos-vm-manager.bb build-iso

# Or use the dedicated builder
bb scripts/sixos-build-iso.bb
```

### 3. Create SixOS VM
```bash
# Create a development VM
bb scripts/sixos-vm-manager.bb create sixos-dev :memory 8192 :cores 8 :disk 50

# Create a minimal testing VM
bb scripts/sixos-vm-manager.bb create sixos-test :memory 2048 :cores 2 :disk 10
```

### 4. Manage VMs
```bash
# List all VMs
bb scripts/sixos-vm-manager.bb list

# Start a VM
bb scripts/sixos-vm-manager.bb start sixos-dev

# Connect to VM (opens virt-manager)
bb scripts/sixos-vm-manager.bb connect sixos-dev

# Stop a VM
bb scripts/sixos-vm-manager.bb stop sixos-dev
```

## SixOS-Specific Features

### s6 Supervision Integration
SixOS uses s6 instead of systemd for process supervision:

```bash
# In SixOS VM, manage services with s6
s6-rc -u change sshd        # Start sshd service
s6-rc -d change sshd        # Stop sshd service
s6-rc -l                     # List all services
```

### Declarative Configuration
SixOS inherits NixOS's declarative configuration:

```nix
# /etc/nixos/configuration.nix
{ config, pkgs, ... }:
{
  # Enable s6 supervision (instead of systemd)
  services.s6.enable = true;
  
  # Enable Wayland + Hyprland
  services.xserver.enable = false;
  programs.hyprland.enable = true;
  
  # Framework 16 specific
  hardware.opengl.enable = true;
  hardware.opengl.driSupport = true;
  services.xserver.videoDrivers = [ "amdgpu" ];
  
  # Essential packages
  environment.systemPackages = with pkgs; [
    wezterm
    brave
    cursor
    clojure
    rustc
  ];
}
```

### Grainstore Integration
This environment is designed to work with the Grainstore project:

```clojure
;; grainstore/specs/s6.nock.md - s6 supervision specification
;; grainstore/tests/s6.clj - Clojure implementation tests
;; grainstore/overlays/s6-grainstore.nix - Nix overlay
```

## Framework 16 Optimization

### Hardware-Specific Configuration
```bash
# Create Framework 16 optimized VM
bb scripts/sixos-vm-manager.bb create framework-16-sixos \
  :memory 8192 \
  :cores 8 \
  :disk 50
```

### AMD GPU Support
SixOS includes excellent AMD GPU support:
- `amdgpu` kernel driver (mainlined)
- Open source graphics stack
- Excellent Wayland support
- No proprietary blobs required

## Development Workflow

### 1. Build and Test
```bash
# Build SixOS ISO with your changes
bb scripts/sixos-build-iso.bb

# Test in VM
bb scripts/sixos-vm-manager.bb run-qemu /path/to/sixos.iso
```

### 2. Deploy to Framework 16
```bash
# Flash to USB (when ready)
bb scripts/sixos-flash-usb.bb /dev/sdb

# Boot Framework 16 from USB
# Follow installation guide
```

### 3. Iterate and Improve
```bash
# Make changes to SixOS configuration
# Build new ISO
# Test in VM
# Deploy to hardware
```

## Advanced Features

### VM Templates
Pre-configured VM templates for different use cases:

- **sixos-dev**: Full development environment
- **sixos-test**: Minimal testing environment  
- **sixos-minimal**: Bare minimum for s6 testing
- **framework-16-sixos**: Hardware-optimized

### Backup and Recovery
```bash
# Automatic daily backups
# Manual backup
bb scripts/vm-manager.sh backup sixos-dev

# Restore from backup
# (Manual process - see backup directory)
```

### Monitoring and Logs
```bash
# View VM logs
tail -f logs/sixos-vm-manager.log

# Monitor VM resources
virsh domstats sixos-dev
```

## Integration with Existing Workflow

This SixOS virtualization environment integrates with your existing:

- **Babashka tooling** - All scripts use bb
- **Grainstore project** - Verified dependencies
- **Functional programming** - Clojure-based management
- **Nix ecosystem** - Declarative configuration
- **Framework 16** - Hardware optimization

## Next Steps

1. **Build your first SixOS ISO** ðŸŽŠ
2. **Create a development VM** ðŸ–¤
3. **Test s6 supervision** ðŸ’™
4. **Integrate with Grainstore** ðŸ¤Ž
5. **Deploy to Framework 16** ðŸŽŠ

## Resources

- [SixOS Repository](https://codeberg.org/amjoseph/sixos)
- [s6 Supervision](https://skarnet.org/software/s6/)
- [NixOS Manual](https://nixos.org/manual/nixos/stable/)
- [Framework 16 Documentation](https://frame.work/)

---

*"In the valley, we discovered that the mightiest tree isn't always the strongestâ€”sometimes it's the one that knows when to shed what it doesn't need."* - SixOS Philosophy ðŸŽŠ
