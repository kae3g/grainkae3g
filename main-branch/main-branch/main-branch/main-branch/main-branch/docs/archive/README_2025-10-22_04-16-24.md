# QEMU/KVM Virtualization Environment with SixOS Support 🎊

A comprehensive virtualization setup specifically designed for SixOS (NixOS without systemd) development and testing on Framework 16 hardware.

## What We've Built 🖤🤎💙

This project provides a complete QEMU/KVM virtualization environment optimized for:

- **SixOS Development** - NixOS without systemd, using s6 supervision
- **Framework 16 Hardware** - AMD Ryzen 7040 Series optimization
- **Grainstore Integration** - Verified dependencies and specifications
- **Functional Programming** - Clojure-based management with Babashka

## Project Structure

```
~/kae3g/12025-10/
├── vms/                    # Virtual machine storage
│   ├── sixos-dev/         # SixOS development VM
│   ├── sixos-test/        # SixOS testing VM
│   └── grainstore/        # Grainstore development files
├── isos/                   # SixOS installer ISOs
├── scripts/                # Management scripts
│   ├── vm-manager.sh      # General VM management
│   ├── sixos-vm-manager.bb # SixOS-specific management (Babashka)
│   └── sixos-build-iso.bb # SixOS ISO builder
├── configs/                # Configuration files
│   └── sixos-vm-config.edn # SixOS VM specifications
├── backups/                # VM backups
├── logs/                   # Management logs
├── README.md              # This file
└── README-SIXOS.md        # SixOS-specific documentation
```

## Quick Start

### 1. Prerequisites
All prerequisites are already installed:
- ✅ QEMU/KVM with libvirt
- ✅ Babashka (Clojure scripting)
- ✅ Nix package manager
- ✅ Java 17 (for Babashka)

### 2. Build SixOS ISO
```bash
# Source Nix environment
source /home/xy/.nix-profile/etc/profile.d/nix.sh

# Build SixOS installer ISO
bb scripts/sixos-vm-manager.bb build-iso
```

### 3. Create SixOS VM
```bash
# Create a development VM
bb scripts/sixos-vm-manager.bb create sixos-dev :memory 8192 :cores 8 :disk 50

# Create a minimal testing VM
bb scripts/sixos-vm-manager.bb create sixos-test :memory 2048 :cores 2 :disk 10
```

### 4. Manage VMs
```bash
# List all VMs
bb scripts/sixos-vm-manager.bb list

# Start a VM
bb scripts/sixos-vm-manager.bb start sixos-dev

# Connect to VM (opens virt-manager)
bb scripts/sixos-vm-manager.bb connect sixos-dev

# Stop a VM
bb scripts/sixos-vm-manager.bb stop sixos-dev
```

## SixOS Features

### s6 Supervision
SixOS uses s6 instead of systemd for process supervision:
- **Lightweight** - 200KB vs 1.5MB for systemd
- **Unix philosophy** - Small, focused components
- **Declarative** - Services managed like Nix packages

### Declarative Configuration
```nix
# /etc/nixos/configuration.nix
{ config, pkgs, ... }:
{
  # Enable s6 supervision (instead of systemd)
  services.s6.enable = true;
  
  # Enable Wayland + Hyprland
  services.xserver.enable = false;
  programs.hyprland.enable = true;
  
  # Framework 16 specific
  hardware.opengl.enable = true;
  services.xserver.videoDrivers = [ "amdgpu" ];
}
```

### Grainstore Integration
This environment integrates with your Grainstore project:
- **Verified dependencies** - Nock-specified components
- **Clojure tests** - Functional programming approach
- **Nix overlays** - Declarative package management

## Framework 16 Optimization

### Hardware Support
- **AMD Ryzen 7040 Series** - 8 cores, 16 threads
- **AMD Radeon 780M** - RDNA 3 with open drivers
- **32GB DDR5-5600** - Plenty of RAM for VMs
- **1TB NVMe SSD** - Fast storage for VMs

### AMD GPU Support
- `amdgpu` kernel driver (mainlined)
- Open source graphics stack
- Excellent Wayland support
- No proprietary blobs required

## Development Workflow

### 1. Build and Test
```bash
# Build SixOS ISO with your changes
bb scripts/sixos-build-iso.bb

# Test in VM
bb scripts/sixos-vm-manager.bb run-qemu /path/to/sixos.iso
```

### 2. Deploy to Framework 16
```bash
# Flash to USB (when ready)
bb scripts/sixos-flash-usb.bb /dev/sdb

# Boot Framework 16 from USB
# Follow installation guide
```

### 3. Iterate and Improve
```bash
# Make changes to SixOS configuration
# Build new ISO
# Test in VM
# Deploy to hardware
```

## Management Scripts

### General VM Management
```bash
# Using the shell script
./scripts/vm-manager.sh list
./scripts/vm-manager.sh create ubuntu-server 2048 20 /path/to/iso 2
./scripts/vm-manager.sh start ubuntu-server
./scripts/vm-manager.sh backup ubuntu-server
```

### SixOS-Specific Management
```bash
# Using Babashka (Clojure)
bb scripts/sixos-vm-manager.bb build-iso
bb scripts/sixos-vm-manager.bb create sixos-dev :memory 8192 :cores 8
bb scripts/sixos-vm-manager.bb start sixos-dev
bb scripts/sixos-vm-manager.bb connect sixos-dev
```

## Configuration

### VM Templates
Pre-configured templates in `configs/sixos-vm-config.edn`:
- **sixos-dev**: Full development environment
- **sixos-test**: Minimal testing environment  
- **sixos-minimal**: Bare minimum for s6 testing
- **framework-16-sixos**: Hardware-optimized

### Network Configurations
- **Default bridge**: `virbr0` for standard networking
- **Host-only**: Isolated VM network
- **Passthrough**: Direct host network access

## Integration with Your Workflow

This environment integrates with your existing:
- **Babashka tooling** - All scripts use bb
- **Grainstore project** - Verified dependencies
- **Functional programming** - Clojure-based management
- **Nix ecosystem** - Declarative configuration
- **Framework 16** - Hardware optimization

## Next Steps

1. **Build your first SixOS ISO** 🎊
2. **Create a development VM** 🖤
3. **Test s6 supervision** 💙
4. **Integrate with Grainstore** 🤎
5. **Deploy to Framework 16** 🎊

## Resources

- [SixOS Repository](https://codeberg.org/amjoseph/sixos)
- [s6 Supervision](https://skarnet.org/software/s6/)
- [NixOS Manual](https://nixos.org/manual/nixos/stable/)
- [Framework 16 Documentation](https://frame.work/)
- [Babashka Documentation](https://babashka.org/)

---

*"In the valley, we discovered that the mightiest tree isn't always the strongest—sometimes it's the one that knows when to shed what it doesn't need."* - SixOS Philosophy 🎊

**Built with ❤️ for functional programming, personal sovereignty, and the future of computing.**